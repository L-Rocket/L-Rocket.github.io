import{_ as S,d as V,r as C,o as q,a as O,c as B,b as m,e as P,w as T,F as N,u as W,f as j,g as H,h as L,i as U,E as G,j as Q}from"./index-D7uKyRgQ.js";async function Y(){const n=await S(()=>import("./wasm-BfhswlHx.js"),__vite__mapDeps([])).then(e=>e.cv);await n.ready;const l=await K(n);return{cv:n,qrcode_detector:l}}let E;async function z(){return E||(E=Y()),E}async function J(n,l={}){const{cv:e,qrcode_detector:v}=await z(),d=e.imread(n,e.IMREAD_GRAYSCALE),u=new e.MatVector,w=v.detectAndDecode(d,u),c=u.get(0),i=c?{x:c.floatAt(0),y:c.floatAt(1),width:c.floatAt(4)-c.floatAt(0),height:c.floatAt(5)-c.floatAt(1)}:void 0;let h;if(i&&l.includeRectCanvas){h=document.createElement("canvas");const _=d.roi(new e.Rect(i.x,i.y,i.width,i.height));e.imshow(h,_),_.delete()}return d.delete(),{text:w.get(0),rect:i,rectCanvas:h}}async function K(n){const l=await S(()=>import("./wasm-BfhswlHx.js"),__vite__mapDeps([]));return n.FS_createDataFile("/","detect.prototxt",l.detect_prototxt,!0,!1,!1),n.FS_createDataFile("/","detect.caffemodel",l.detect_caffemodel,!0,!1,!1),n.FS_createDataFile("/","sr.prototxt",l.sr_prototxt,!0,!1,!1),n.FS_createDataFile("/","sr.caffemodel",l.sr_caffemodel,!0,!1,!1),new n.wechat_qrcode_WeChatQRCode("detect.prototxt","detect.caffemodel","sr.prototxt","sr.caffemodel")}const X=m("head",null,null,-1),$=V({__name:"ScanView",setup(n){const l=C(null),e=C(null),v=C(null);let d=null,u=new Map;const w=W(),c=j(),i=[],h=()=>{c.commit("setData",i)},_=async()=>{await R(),h(),w.push("/")},A=async(t,a,o,f)=>{const p=window.navigator.mediaDevices;if(await p.enumerateDevices())try{if(f){const r=await p.getUserMedia({audio:!1,video:{facingMode:t}});e.value&&(e.value.srcObject=r,e.value.play())}else{const r=await p.getUserMedia({audio:!1,video:{width:a,height:o,facingMode:t}});e.value&&(e.value.srcObject=r,e.value.play())}}catch(r){console.error("Error accessing camera:",r)}};q(async()=>{await A("environment",window.innerHeight,window.innerWidth,!1)}),O(async()=>{setTimeout(I,1500)});const R=async()=>{await b(),d&&(clearInterval(d),d=null)},b=()=>{document.querySelectorAll("canvas").forEach(a=>{const o=a.getContext("2d");o&&o.clearRect(0,0,a.width,a.height)})},D=t=>{M(),G({title:"检测到新二维码：",message:Q("i",{style:"color: teal"},t)})},M=()=>{v.value&&v.value.play()},k=async()=>{if(!e.value)return null;let t=document.createElement("canvas");t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.width=e.value.videoWidth,t.height=e.value.videoHeight;let a=t.getContext("2d");return a?(a.fillStyle="rgba(255, 255, 0, 0.5)",a.strokeStyle="red",{VideoCanvas:t,ctx:a}):null},F=async(t,a)=>{if(!e.value||a===null)return;const o=document.createElement("canvas");o.width=e.value.videoWidth,o.height=e.value.videoHeight,o.style.position="absolute",o.style.left="0px",o.style.top="0px";const f=o.getContext("2d");if(f){f.drawImage(e.value,0,0,t.width,t.height),f.fillStyle="rgba(255, 255, 0, 1)",a.font="bold 20px Roboto";for(let p=0;p<4;p++){const s=await J(o);if(console.log("result",s),!s||!s.rect||!s.text)continue;const{x:r,y,height:x,width:g}=s.rect;f.fillRect(r,y,g,x),a.fillRect(r,y,g,x),a.strokeRect(r,y,g,x),a.fillStyle="black",a.fillText(s.text,r,y),a.fillStyle="rgba(255, 255, 0, 0.5)",u.has(s.text)||(u.set(s.text,s.rect),i.push(s.text),console.log("result.text",s.text),D(s.text))}console.log("resultMap",u),l.value&&await l.value.appendChild(t)}},I=async()=>{const t=await k();if(!t){console.error("Failed to create canvas and snapshot.");return}d=setInterval(async()=>{await b(),await F(t.VideoCanvas,t.ctx)},100)};return(t,a)=>{const o=H("el-button");return L(),B(N,null,[X,m("main",null,[m("div",{ref_key:"MyPoints",ref:l,style:{position:"absolute",top:"0px",left:"0px"}},[m("video",{ref_key:"videoEl",ref:e},null,512)],512),P(o,{type:"success",round:"",onClick:_,style:{position:"absolute",bottom:"30px"}},{default:T(()=>[U("返回")]),_:1}),m("audio",{ref_key:"audioElement",ref:v,src:"src/assets/alert.mp3",preload:"auto"},null,512)])],64)}}});export{$ as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
